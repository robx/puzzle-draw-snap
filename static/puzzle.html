<!doctype html>
<html>
<head></head>
<body>
<script src="jquery.js"></script>
 
<h3>puzzle-draw demo</h3>

<p>
Renders a puzzle description to svg.
</p>

<div>
<div><select id="exampleList">
  <option value="fillomino">fillomino</option>
  <option value="slitherlink">slitherlink</option>
</select></div>
<textarea id="puzzle" rows="20" cols="80" style="font-family: monospace">
type: fillomino
puzzle: |
  1234
  ....
  ....
  3...
solution: |
  1234
  3234
  3134
  3224
</textarea></div>
<div>
<input type="radio" name="output" value="puzzle" checked=1>puzzle</input>
<input type="radio" name="output" value="solution">solution</input>
<input type="radio" name="output" value="both">both</input>
<button id="renderButton">Render</button>
</div>

<div><img id="drawing" /><span id="error" style="display: none"</div>

<script>
$(function() {
    $.getJSON("/examples", function(data) {
        $.each(data, function(i, ex) {
            $("#exampleList").append(
                $('<option>', { 'value': ex.path }).text(ex.name));
        });
    });
});

$("#exampleList").change(function() {
    $.ajax({
        url: $(this).val(),
        type: "GET",

        success: function(text) {
            $("#puzzle").val(text);
        }
    })
});

$("#renderButton").click(function(event) {
    $.ajax({
        url: "/puzzle?" + $.param({
            output: $("input[name=output]:checked").val()
        }),
 
        data: $("#puzzle").val(),
 
        type: "POST",
        contentType: "application/x-yaml",
        processData: false,
 
        dataType : "text",
 
        success: function(text) {
            $("#drawing").attr("src", "data:image/svg+xml," + text);
            $("#error").hide();
            $("#drawing").show();
        },

        error: function(req) {
            $("#drawing").hide();
            $("#error").text("error: " + req.responseText);
            $("#error").show();
        }
    });
});
</script>
 
</body>
</html>
